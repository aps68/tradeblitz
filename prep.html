<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TradeBlitz Dashboard - Daily Pre-Market Prep">
    <title>Daily Prep | TradeBlitz Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="glow-orb orb-1"></div>
    <div class="glow-orb orb-2"></div>
    <div class="grid-overlay"></div>

    <nav id="navbar" class="scrolled">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-text">TradeBlitz Dashboard</span>
            </div>
            <div class="nav-links">
                <a href="prep.html" class="active" style="color: #fff;">Daily Prep</a>
                <a href="execute.html">Execute</a>
                <a href="journal.html">Journal</a>
                <a href="tradingclass.html">Trading Class</a>
                <a href="chat.html">AI Chat</a>
            </div>
            <a href="index.html" class="btn-nav">Log Out</a>
        </div>
    </nav>

    <section class="routine-section" style="padding-top: 10rem; min-height: 100vh;">
        <div class="container">
            <h2 class="section-title">Pre-Market Prep ‚òÄÔ∏è</h2>
            <p class="section-subtitle">Review today's high-impact news, set your daily bias, and complete your
                checklist before executing.</p>

            <div class="dashboard-grid"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 3rem;">

                <!-- Left: Unfiltered Forex Factory Replica -->
                <div class="ff-panel">
                    <div class="ff-header">
                        <div class="ff-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"
                                style="margin-right:5px;">
                                <path
                                    d="M19 4h-3V2h-2v2h-4V2H8v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10z" />
                            </svg> All News (Unfiltered)</div>
                        <div class="ff-date">Today</div>
                    </div>
                    <div class="ff-table-container">
                        <table class="ff-table" id="ff-unfiltered">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Currency</th>
                                    <th>Impact</th>
                                    <th>Event</th>
                                    <th>Actual</th>
                                    <th>Forecast</th>
                                    <th>Previous</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS inserts rows here -->
                            </tbody>
                        </table>
                        <div id="loader-unfiltered" style="padding: 2rem; text-align: center; color: #666;">Loading live
                            calendar data...</div>
                    </div>
                </div>

                <!-- Right: Red Only Forex Factory Replica -->
                <div class="ff-panel">
                    <div class="ff-header" style="background: linear-gradient(180deg, #d32f2f, #b71c1c);">
                        <div class="ff-title"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"
                                style="margin-right:5px;">
                                <path
                                    d="M19 4h-3V2h-2v2h-4V2H8v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10z" />
                            </svg> High Impact (Red Only)</div>
                        <div class="ff-date">Today</div>
                    </div>
                    <div class="ff-table-container">
                        <table class="ff-table" id="ff-filtered">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Currency</th>
                                    <th>Impact</th>
                                    <th>Event</th>
                                    <th>Actual</th>
                                    <th>Forecast</th>
                                    <th>Previous</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS inserts rows here -->
                            </tbody>
                        </table>
                        <div id="loader-filtered" style="padding: 2rem; text-align: center; color: #666;">Loading live
                            calendar data...</div>
                    </div>
                </div>

            </div>

            <!-- Pre-Market Checklist & Levels Section -->
            <div class="dashboard-grid"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 3rem;">

                <!-- Trade Rules -->
                <div class="glass-panel" style="padding: 2rem; border-radius: 16px; background: #0b0d17; height: 100%;">
                    <h3
                        style="font-size: 1.5rem; color: #fff; margin-bottom: 1.5rem; font-family: var(--font-heading);">
                        <span style="margin-right:0.5rem">üìê</span> Trade Execution Rules
                    </h3>

                    <div class="rules-list" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div
                            style="color: #e2e8f0; font-size: 1.05rem; padding: 1.2rem; background: #12141f; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); border-left: 4px solid #3b82f6;">
                            <strong style="color: #60a5fa; display: block; margin-bottom: 0.3rem;">1. 15-Minute Candle
                                Confirmation</strong>
                            The price must break out or break down from the key levels and <strong>close</strong> on the
                            15-minute timeframe before taking an entry.
                        </div>

                        <div
                            style="color: #e2e8f0; font-size: 1.05rem; padding: 1.2rem; background: #12141f; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); border-left: 4px solid #ef4444;">
                            <strong style="color: #f87171; display: block; margin-bottom: 0.3rem;">2. Stop Loss (SL)
                                Placement</strong>
                            <ul
                                style="margin-top: 0.5rem; padding-left: 1.5rem; list-style-type: disc; color: #94a3b8;">
                                <li style="margin-bottom: 0.25rem;"><strong>Breakout (Long):</strong> Place SL 1.5
                                    points below the low of the breakout candle.</li>
                                <li><strong>Breakdown (Short):</strong> Place SL 1.5 points above the high of the
                                    breakdown candle.</li>
                            </ul>
                        </div>

                        <div
                            style="color: #e2e8f0; font-size: 1.05rem; padding: 1.2rem; background: #12141f; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05); border-left: 4px solid #10b981;">
                            <strong style="color: #34d399; display: block; margin-bottom: 0.3rem;">3. Target
                                Risk-to-Reward</strong>
                            Strictly structure the trade to capture a minimum of <strong>1:2 Risk-to-Reward
                                (R:R)</strong> ratio.
                        </div>
                    </div>
                </div>

                <!-- Live Trading Levels -->
                <div class="glass-panel"
                    style="padding: 2rem; border-radius: 16px; background: #0b0d17; height: 100%; display: flex; flex-direction: column;">
                    <h3
                        style="font-size: 1.5rem; color: #fff; margin-bottom: 1.5rem; font-family: var(--font-heading);">
                        <span style="margin-right:0.5rem">üéØ</span> Today's Trading Levels
                    </h3>

                    <!-- Display Screenshot here -->
                    <div
                        style="flex-grow: 1; display: flex; align-items: center; justify-content: center; background: #12141f; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); padding: 5px; overflow: hidden;">
                        <img src="daily-levels.png" alt="Today's Trading Levels"
                            style="max-width: 100%; max-height: 400px; border-radius: 8px; object-fit: contain;">
                    </div>

                    <p
                        style="color: #64748b; font-size: 0.9rem; margin-top: 1.5rem; line-height: 1.5; text-align: center;">
                        <strong>Instructor Note:</strong> Replace <code>daily-levels.png</code> in your root folder
                        every morning to update this chart for all students automatically.
                    </p>
                </div>

            </div>
        </div>
    </section>

    <style>
        .ff-panel {
            background: #ffffff;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            font-family: Arial, sans-serif;
            color: #333;
        }

        .ff-header {
            background: linear-gradient(180deg, #51719b, #3e5a7e);
            color: white;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: bold;
        }

        .ff-table-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .ff-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .ff-table th {
            background: #e0e6ed;
            color: #555;
            padding: 6px 8px;
            text-align: left;
            border-bottom: 2px solid #ccc;
            font-weight: bold;
        }

        .ff-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        .ff-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .ff-table tr:hover {
            background-color: #f1f5f9;
        }

        .impact-icon {
            display: inline-block;
            width: 14px;
            height: 12px;
            border-radius: 2px;
        }

        .impact-High {
            background: #d32f2f;
        }

        .impact-Medium {
            background: #f57c00;
        }

        .impact-Low {
            background: #fbc02d;
        }

        .impact-Non-Economic {
            background: #9e9e9e;
        }

        .currency-col {
            font-weight: bold;
            color: #555;
        }

        .title-col {
            color: #000;
            font-weight: 500;
        }
    </style>

    <script>
        async function fetchForexFactoryData() {
            try {
                // Using allorigins to bypass CORS for the public open JSON
                const url = 'https://nfs.faireconomy.media/ff_calendar_thisweek.json';
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                const data = await response.json();

                const events = JSON.parse(data.contents);

                // Filter for Today only
                const today = new Date();
                const todayEvents = events.filter(e => {
                    const eventDate = new Date(e.date);
                    return eventDate.getDate() === today.getDate() &&
                        eventDate.getMonth() === today.getMonth() &&
                        eventDate.getFullYear() === today.getFullYear();
                });

                renderTable('ff-unfiltered', 'loader-unfiltered', todayEvents);

                const highImpact = todayEvents.filter(e => e.impact === 'High');
                renderTable('ff-filtered', 'loader-filtered', highImpact);

            } catch (err) {
                console.error("Failed to load calendar", err);
                document.getElementById('loader-unfiltered').innerText = "Failed to load data. Refresh to try again.";
                document.getElementById('loader-filtered').innerText = "Failed to load data. Refresh to try again.";
            }
        }

        function formatTime(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        function renderTable(tableId, loaderId, data) {
            document.getElementById(loaderId).style.display = 'none';
            const tbody = document.querySelector(`#${tableId} tbody`);
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding: 2rem;">No events found</td></tr>';
                return;
            }

            let currentDate = '';

            data.forEach(item => {
                const itemDate = formatDate(item.date);
                const showDate = itemDate !== currentDate;
                if (showDate) currentDate = itemDate;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="color: #666; font-weight: ${showDate ? 'bold' : 'normal'};">
                        ${showDate ? itemDate : ''}
                    </td>
                    <td style="color:#555;">${formatTime(item.date)}</td>
                    <td class="currency-col">${item.country}</td>
                    <td><div class="impact-icon impact-${item.impact}" title="${item.impact} Impact"></div></td>
                    <td class="title-col">${item.title}</td>
                    <td style="color:#10b981; font-weight:bold;">${item.actual || ''}</td>
                    <td>${item.forecast || ''}</td>
                    <td>${item.previous || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Initialize
        fetchForexFactoryData();
    </script>

    <script src="script.js"></script>
    <!-- Admin Login Modal -->
    <div id="adminModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; backdrop-filter: blur(5px);">
        <div class="glass-panel"
            style="background: #0b0d17; padding: 2.5rem; border-radius: 16px; width: 100%; max-width: 400px; border-top: 4px solid #f59e0b; position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h3 style="color: #fff; font-family: var(--font-heading); font-size: 1.5rem; margin: 0;">Admin Login
                </h3>
                <button onclick="document.getElementById('adminModal').style.display='none'"
                    style="background: transparent; border: none; color: #64748b; font-size: 2rem; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label style="color: #94a3b8; font-size: 0.85rem; font-weight: 700; text-transform: uppercase;">Admin
                    ID</label>
                <input type="email" id="adminId" placeholder="Admin ID"
                    style="width: 100%; padding: 1rem; background: #05060a; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; margin-top: 0.5rem; outline: none; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 2rem;">
                <label
                    style="color: #94a3b8; font-size: 0.85rem; font-weight: 700; text-transform: uppercase;">Password</label>
                <input type="password" id="adminPass" placeholder="Password"
                    style="width: 100%; padding: 1rem; background: #05060a; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; margin-top: 0.5rem; outline: none; box-sizing: border-box;">
            </div>

            <button onclick="adminLogin()"
                style="width: 100%; background: #f59e0b; color: #000; font-weight: 800; border: none; padding: 1.2rem; border-radius: 8px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Access
                Dashboard</button>
            <div id="adminError"
                style="color: #ef4444; font-size: 0.85rem; margin-top: 1rem; text-align: center; display: none;">Invalid
                ID or Password.</div>
        </div>
    </div>

    <script>
        function adminLogin() {
            const id = document.getElementById('adminId').value.trim();
            const pass = document.getElementById('adminPass').value.trim();

            if (id === 'akshaypayakkal@gmail.com' && pass === '111198125') {
                window.location.href = 'admin.html';
            } else {
                document.getElementById('adminError').style.display = 'block';
            }
        }
    </script>

    <!-- Ambient BGM Player -->
    <audio id="bgmAudio" loop preload="auto">
        <source src="background.mp3" type="audio/mpeg">
    </audio>
    <button id="bgmToggle" title="Toggle Ambient Music" style="position: fixed; bottom: 20px; left: 20px; z-index: 9999; background: rgba(11, 13, 23, 0.8); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(10px); transition: 0.3s; color: #64748b;">
        <svg id="bgmIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <line id="muteLine1" x1="23" y1="9" x2="17" y2="15"></line>
            <line id="muteLine2" x1="17" y1="9" x2="23" y2="15"></line>
        </svg>
    </button>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const audio = document.getElementById("bgmAudio");
            const toggleBtn = document.getElementById("bgmToggle");
            const icon = document.getElementById("bgmIcon");
            
            audio.volume = 0.4; // Default half volume

            // Restore time & play state across pages
            const savedTime = localStorage.getItem("tradeblitz_bgm_time");
            const isPlaying = localStorage.getItem("tradeblitz_bgm_playing") === "true";
            
            if (savedTime) audio.currentTime = parseFloat(savedTime);

            function setPlayingUI() {
                icon.innerHTML = '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>';
                toggleBtn.style.color = "#10b981";
                toggleBtn.style.borderColor = "rgba(16, 185, 129, 0.3)";
                toggleBtn.style.boxShadow = "0 0 10px rgba(16, 185, 129, 0.2)";
            }
            
            function setMutedUI() {
                icon.innerHTML = '<polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line>';
                toggleBtn.style.color = "#ef4444";
                toggleBtn.style.borderColor = "rgba(239, 68, 68, 0.3)";
                toggleBtn.style.boxShadow = "none";
            }

            if (isPlaying) {
                // Browsers might block this, but we try
                audio.play().then(() => setPlayingUI()).catch(e => setMutedUI());
            } else {
                setMutedUI();
            }
            
            // Save time continuously so jumping pages feels seamless
            setInterval(() => {
                if (!audio.paused) {
                    localStorage.setItem("tradeblitz_bgm_time", audio.currentTime);
                }
            }, 1000);
            
            toggleBtn.addEventListener("click", () => {
                if (audio.paused) {
                    audio.play();
                    setPlayingUI();
                    localStorage.setItem("tradeblitz_bgm_playing", "true");
                } else {
                    audio.pause();
                    setMutedUI();
                    localStorage.setItem("tradeblitz_bgm_playing", "false");
                }
            });
            
            // Try playing anyway on first interaction if they left it playing
            document.body.addEventListener("click", () => {
                if (localStorage.getItem("tradeblitz_bgm_playing") === "true" && audio.paused) {
                    audio.play();
                    setPlayingUI();
                }
            }, { once: true });
        });
    </script>
</body>

</html>